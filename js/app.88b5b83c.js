(function(){"use strict";var e={6782:function(e,t,n){var s=n(9242),i=n(3396),r=n(7139),o=n.p+"img/play_and_refresh.ad2e2d8e.png";const a={style:{height:"150px"}},c={key:0},l={style:{height:"40px"}};function d(e,t,n,s,d,p){const y=(0,i.up)("Keyboard");return(0,i.wg)(),(0,i.iD)(i.HY,null,[(0,i._)("img",{style:{width:"8em",cursor:"pointer"},src:o,onClick:t[0]||(t[0]=(...e)=>p.start&&p.start(...e))}),(0,i._)("div",a,[d.started?((0,i.wg)(),(0,i.iD)("h2",c,"請跟著彈")):(0,i.kq)("",!0),(0,i._)("h1",l,(0,r.zw)(d.playedNotes.join(" ")),1),(0,i._)("h1",{style:{height:"40px"},class:(0,r.C_)(["answer",d.isAnswerCorrect])},(0,r.zw)(d.playerPlayedNotes.join(" ")),3)]),(0,i.Wm)(y,{onSheetPressed:t[1]||(t[1]=e=>p.virtualKeyBoardPressed(e))})],64)}const p={class:"keyboard"},y=["onClick","onKeydown"];function u(e,t,n,s,o,a){return(0,i.wg)(),(0,i.iD)("div",p,[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(o.keys,((e,t)=>((0,i.wg)(),(0,i.iD)("div",{key:t,class:(0,r.C_)(e.class),onClick:t=>this.play(t,e.pitch),onKeydown:t=>this.keypress(t,e)},null,42,y)))),128))])}var h={name:"KeyBoard",props:{msg:String,player:Object},data(){const e=4;return{baseKeyIndex:e,keys:[{class:"white c",pitch:12*e+0,keycode:"KeyA",pressing:!1},{class:"black c-sharp",pitch:12*e+1,keycode:"KeyW",pressing:!1},{class:"white d",pitch:12*e+2,keycode:"KeyS",pressing:!1},{class:"black d-sharp",pitch:12*e+3,keycode:"KeyE",pressing:!1},{class:"white e",pitch:12*e+4,keycode:"KeyD",pressing:!1},{class:"white f",pitch:12*e+5,keycode:"KeyF",pressing:!1},{class:"black f-sharp",pitch:12*e+6,keycode:"KeyT",pressing:!1},{class:"white g",pitch:12*e+7,keycode:"KeyG",pressing:!1},{class:"black g-sharp",pitch:12*e+8,keycode:"KeyY",pressing:!1},{class:"white a",pitch:12*e+9,keycode:"KeyH",pressing:!1},{class:"black a-sharp",pitch:12*e+10,keycode:"KeyU",pressing:!1},{class:"white b",pitch:12*e+11,keycode:"KeyJ",pressing:!1},{class:"white c5",pitch:12*(e+1),keycode:"KeyK",pressing:!1}]}},mounted(){const e=this;window.addEventListener("keydown",(t=>{const n=e.keys.find((e=>e.keycode===t.code));n&&(n.pressing||(n.pressing=!0,this.$emit("sheetPressed",n.pitch)))})),window.addEventListener("keyup",(t=>{const n=e.keys.find((e=>e.keycode===t.code));n&&(n.pressing=!1)}))},methods:{play(e,t){this.$emit("sheetPressed",t)},keydown(e,t){console.log(e,t)}}},f=n(89);const g=(0,f.Z)(h,[["render",u],["__scopeId","data-v-23469031"]]);var w=g,v=window.AudioContext||window.webkitAudioContext,m=new v,k=new window.WebAudioFontPlayer;k.loader.decodeAfterLoading(m,"_tone_0000_JCLive_sf2_file");const _=[{index:60,name:"C4"},{index:62,name:"D4"},{index:64,name:"E4"},{index:65,name:"F4"},{index:67,name:"G4"},{index:69,name:"A4"},{index:71,name:"B4"},{index:72,name:"C5"}];var P={name:"App",components:{Keyboard:w},data(){return{started:!1,playedNotes:[],playerPlayedNotes:[],isAnswerCorrect:"",audioPlayer:void 0}},mounted(){var e=null,t=this;function n(e){const[n,s]=e.data;n>130&&t.handlePlayerInput(s)}function s(t){console.log("MIDI ready!",t),e=t,console.log(e.inputs),i(e)}function i(e){for(let t of e.inputs){var s=t[1];console.log("Input port [type:'"+s.type+"'] id:'"+s.id+"' manufacturer:'"+s.manufacturer+"' name:'"+s.name+"' version:'"+s.version+"'"),s.onmidimessage=n}for(let n of e.outputs){var i=n[1];console.log("Output port [type:'"+i.type+"'] id:'"+i.id+"' manufacturer:'"+i.manufacturer+"' name:'"+i.name+"' version:'"+i.version+"'"),t.outputDevice=i}}function r(e){console.log("Failed to get MIDI access - "+e)}navigator.requestMIDIAccess().then(s,r)},methods:{async start(){this.started=!0,this.playedNotes=[],this.playerPlayedNotes=[],this.playTest()},async playTest(e=2){return new Promise((async t=>{for(let n=0;n<e;n++){let e=Math.floor(Math.random()*_.length),t=_[e];this.playedNotes.push(t.name),await this.playSound(t.index)}t()}))},handlePlayerInput(e){this.playerPlayedNotes.length>=2&&(this.playerPlayedNotes=[]);try{const t=_.find((t=>t.index===e));this.playerPlayedNotes.push(t.name)}catch(t){}},virtualKeyBoardPressed(e){e+=12,this.handlePlayerInput(e),this.playSound(e)},playSound(e=60){return new Promise((t=>{k.queueWaveTable(m,m.destination,window._tone_0000_JCLive_sf2_file,0,e,.75);var n=500;setTimeout((function(){t()}),n)}))},matchTestNotes(){this.isAnswerCorrect="";const e=1e3;if(this.playedNotes.length<2||this.playerPlayedNotes.length<2)return;let t=!1,n=!1,s=this.playerPlayedNotes.length-2;s<=0&&(s=0),this.playerPlayedNotes.length>0&&this.playedNotes[0]===this.playerPlayedNotes[s]&&(t=!0),this.playerPlayedNotes.length>1&&this.playedNotes[1]===this.playerPlayedNotes[this.playerPlayedNotes.length-1]&&(console.log("note 2 correct"),n=!0),t&&n?(this.isAnswerCorrect="correct",setTimeout((()=>{this.start()}),e)):this.isAnswerCorrect="wrong"}},watch:{playerPlayedNotes:{deep:!0,handler:function(e){this.matchTestNotes(e)}}}};const b=(0,f.Z)(P,[["render",d],["__scopeId","data-v-2a797a74"]]);var K=b;(0,s.ri)(K).mount("#app")}},t={};function n(s){var i=t[s];if(void 0!==i)return i.exports;var r=t[s]={exports:{}};return e[s](r,r.exports,n),r.exports}n.m=e,function(){var e=[];n.O=function(t,s,i,r){if(!s){var o=1/0;for(d=0;d<e.length;d++){s=e[d][0],i=e[d][1],r=e[d][2];for(var a=!0,c=0;c<s.length;c++)(!1&r||o>=r)&&Object.keys(n.O).every((function(e){return n.O[e](s[c])}))?s.splice(c--,1):(a=!1,r<o&&(o=r));if(a){e.splice(d--,1);var l=i();void 0!==l&&(t=l)}}return t}r=r||0;for(var d=e.length;d>0&&e[d-1][2]>r;d--)e[d]=e[d-1];e[d]=[s,i,r]}}(),function(){n.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return n.d(t,{a:t}),t}}(),function(){n.d=function(e,t){for(var s in t)n.o(t,s)&&!n.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})}}(),function(){n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){n.p="/javascript-music-interval-training/"}(),function(){var e={143:0};n.O.j=function(t){return 0===e[t]};var t=function(t,s){var i,r,o=s[0],a=s[1],c=s[2],l=0;if(o.some((function(t){return 0!==e[t]}))){for(i in a)n.o(a,i)&&(n.m[i]=a[i]);if(c)var d=c(n)}for(t&&t(s);l<o.length;l++)r=o[l],n.o(e,r)&&e[r]&&e[r][0](),e[r]=0;return n.O(d)},s=self["webpackChunkjavascript_music_interval_training"]=self["webpackChunkjavascript_music_interval_training"]||[];s.forEach(t.bind(null,0)),s.push=t.bind(null,s.push.bind(s))}();var s=n.O(void 0,[998],(function(){return n(6782)}));s=n.O(s)})();
//# sourceMappingURL=app.88b5b83c.js.map